<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>AN_Labo1_Groupe3</title>
	</head>

	<body>
		<h1>Convertisseur Decimal-Binaire flottant</h1>
		<p>
		<label for="nBit">Codage sur </label>
		<input type="number" name="nBit" id="nBit" value="16" min="1"/>bits
		</p>
		<p>
		<label for="nb1">Premier nombre a convertir: </label>
		<input type="text" name="nb1" id="nb1" value="0"/><sub>10</sub>
		&lt;=&gt;
		<input type="text" name="bin1" id="bin1" /><sub>2</sub>
		</p>
		<p>
		<button type="button" name="conv1" id="conv1">Decimal -> Binaire</button>
		<button type="button" name="conve1" id="conve1">Binaire -> Decimal</button>
		</p>
		<p>
		<label for="nb2">Second nombre à convertir: </label>
		<input type="text" name="nb2" id="nb2" value="0"/><sub>10</sub>
		&lt;=&gt;
		<input type="text" name="bin2" id="bin2" /><sub>2</sub>
		</p>
		<p>
		<button type="button" name="conv2" id="conv2">Decimal -> Binaire</button>
		<button type="buton" name="conve2" id="conve2">Binaire -> Decimal</button>
		</p>
		<p>
		<label for="add">Opération entre les nombres:</label>
		<button type="button" name="add" id="add">Addition</button>
		</p>
		<p>
		Résultat du calcul:
		<input type="number" name="resDec" id="resDec" value="0" disabled="disabled"/><sub>10</sub>
		&lt;=&gt;
		<input type="text" name="resBin" id="resBin" disabled="disabled"/><sub>2</sub>
		</p>
			
		<script>
		document.getElementById("conv1").addEventListener("click", function(){decimalToBinary(1);});
		document.getElementById("conve1").addEventListener("click",function(){binaryToDecimal(1);});
		document.getElementById("conv2").addEventListener("click",function(){decimalToBinary(2);});
		document.getElementById("conve2").addEventListener("click",function(){binaryToDecimal(2);});
		document.getElementById("add").addEventListener("click",function(){addition();});
		document.getElementById("nb1").addEventListener("change", function(){decimalToBinary(1);});
		document.getElementById("nb2").addEventListener("change", function(){decimalToBinary(2);});
		document.getElementById("bin1").addEventListener("change", function(){binaryToDecimal(1);});
		document.getElementById("bin2").addEventListener("change", function(){binaryToDecimal(2);});

		function decimalToBinary(id){
			var nbaconvertir = parseFloat(document.getElementById("nb"+id).value);
			var nbBit = document.getElementById("nBit").value;	
			var res = [];
			var tabInt = [];
			var tabDec = [];
			var mantisse = [];
			var exposant = [];
			var expo = 0;
			var bitSigne = 0;
			var partInt = 0;
			var partDec = 0;

			if(nbBit<16){
				alert("Le nombre de bit minimum est de 16");
			}
		
			if(nbaconvertir == 0){
				//Si le nombre a convertir vaut 0 alors la sortie est un tableau de 0
				for(var i = 0; i <= nbBit; i++){
					res[i] = 0;				
				}
				document.getElementById("bin"+id).value = res.reverse().join("");
			}else{
				//Conversion si le nombre n'est pas égal à 0
				//Test si le signe est positif ou négatif et assigne le bit de signe
				if(nbaconvertir < 0){
					bitSigne = 1;
				}
				else{
					bitSigne = 0;
				}
				
				//Calcul du nombre de bit d'exposant
				var nbExpo = 5+3*(Math.log(nbBit/16)/Math.log(2));
				nbExpo = parseInt(nbExpo);
				//Calcul du nombre de bit de la mantisse
				var nbMantisse = nbBit - 1 - nbExpo;
				
				//Fabrication du tableau de la mantisse 

				partInt = Math.abs(parseInt(nbaconvertir));
				partDec = Math.abs(nbaconvertir) - partInt;
				
				i = 0;
				var quotient = 1; 
				while((quotient != 0) && (nbMantisse - tabInt.length > 0)){
					tabInt[i] = partInt%2;
					partInt = parseInt(partInt/2);
					quotient = partInt;
					i = i + 1;
				}
				tabInt = tabInt.reverse();
				expo = (tabInt.length)-1;

				i = 0;
				var result = partDec *2;
				while((result != 1) && (nbMantisse - tabInt.length - tabDec.length > 0)){
					if(result > 1){
						tabDec[i] = 1;
						result = result - 1; 
					}else{
						tabDec[i] = 0;	
					}
					result = result*2;
					i = i+1;
				}
				i = i+1; 
				tabDec[i] = 1;
				tabInt.shift();
				mantisse = tabInt.concat(tabDec);

				expo += (Math.pow(2,nbExpo-1)-1);
				
				i = 0; 
				quotient = 1;
				while(quotient!= 0){
					exposant[i] = expo%2; 
					expo = parseInt(expo/2);
					quotient = expo; 
					i = i + 1;
				}
				if(exposant.length < nbExpo){
					for(i=exposant.length; i < nbExpo; i++){
						exposant[i]=0;
					}
				}
				exposant = exposant.reverse();
				
				res[0] = bitSigne;
				res = res.concat(exposant);
				res = res.concat(mantisse);
				
				for(i = res.length; i <= nbBit; i++){
					res[i] = 0;
				}

				document.getElementById("bin"+id).value = res.join("");
			}
			
		}
		</script>
	</body>
</html>
