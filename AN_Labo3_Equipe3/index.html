<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Labo 3</title>
</head>
<body>

<p>
    <input type="file" id="hiddenfile"/>
</p>
<p>
    <button type="button" name="Process" id="Process" onclick="process()" disabled>Process !</button>
</p>
<div id="footer"></div>

<script type="text/javascript">

    //-------------------------------------------------------------------
    //-------------------------------------------------------------------
    //----------- DEFINITION DES FONCTIONS CLICK ET CHANGE --------------
    //-------------------------------------------------------------------
    //-------------------------------------------------------------------

    var matrixSpecs;

    document.getElementById('hiddenfile').addEventListener('change', handleFileSelect, false);
    var footer = document.getElementById('footer');

    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object

        // files is a FileList of File objects. List some properties.
        var output = [];
        for (var i = 0, f; f = files[i]; i++) {
            var reader = new FileReader();

            // Closure to capture the file information.
            reader.onload = (function (theFile) {
                return function (e) {
                    try {
                        matrixSpecs = JSON.parse(e.target.result);
                        document.getElementById('Process').disabled = false;
                    } catch (ex) {
                        alert('ex when trying to parse matrixSpecs = ' + ex);
                    }
                }
            })(f);
            reader.readAsText(f);
        }
    }

    function process() {
        var n = matrixSpecs.n[0];
        var A = matrixSpecs.A;
        var B = matrixSpecs.B;
        var vector = new Array(n);

        insertParagraphAtEnd("Ordre de la matrice : " + n);
        insertParagraphAtEnd("Matrice : " + A);
        insertParagraphAtEnd("Vecteur : " + B);

        //cr√©ation de la matrice
        var matrix = new Array(n);
        for (var k = 0; k < n; k++) {
            matrix[k] = new Array(n);
        }

        //Remplissage de la matrice
        for (var i = 0; i < n * n; i += n) {
            for (var j = 0; j < n; j++) {
                matrix[parseInt(i / n)][parseInt(j)] = A[parseInt(i + j)];
            }
            insertParagraphAtEnd(matrix[parseInt(i / n)] + " = " + B[parseInt(i / n)]);
        }

        vector = gauss(matrix, B);
        vector.forEach(function(entry) {
            alert(entry*5);
        });
    }

    var abs = Math.abs;
    function gauss(A, x) {

        var i, k, j;

        // Just make a single matrix
        for (i = 0; i < A.length; i++) {
            A[i].push(x[i]);
        }
        var n = A.length;

        for (i = 0; i < n; i++) {
            // Search for maximum in this column
            var maxEl = abs(A[i][i]),
                    maxRow = i;
            for (k = i + 1; k < n; k++) {
                if (abs(A[k][i]) > maxEl) {
                    maxEl = abs(A[k][i]);
                    maxRow = k;
                }
            }


            // Swap maximum row with current row (column by column)
            for (k = i; k < n + 1; k++) {
                var tmp = A[maxRow][k];
                A[maxRow][k] = A[i][k];
                A[i][k] = tmp;
            }

            // Make all rows below this one 0 in current column
            for (k = i + 1; k < n; k++) {
                var c = -A[k][i] / A[i][i];
                for (j = i; j < n + 1; j++) {
                    if (i === j) {
                        A[k][j] = 0;
                    } else {
                        A[k][j] += c * A[i][j];
                    }
                }
            }

            // Solve equation Ax=b for an upper triangular matrix A
            x = array_fill(0, n, 0);
            for (i = n - 1; i > -1; i--) {
                x[i] = A[i][n] / A[i][i];
                for (k = i - 1; k > -1; k--) {
                    A[k][n] -= A[k][i] * x[i];
                }
            }

            return x;
        }
    }

    function array_fill(i, n, v) {
        var a = [];
        for (; i < n; i++) {
            a.push(v);
        }
        return a;
    }

    function insertParagraphAtEnd(t) {
        var para = document.createElement("p");
        var text = document.createTextNode(t);
        para.appendChild(text);
        document.body.insertBefore(para, footer);
    }
</script>

</body>

</html>